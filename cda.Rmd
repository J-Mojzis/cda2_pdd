---
title: "CDA2 Challenge"
output: html_notebook
---


```{r}
#Librarys installieren
library(tidyverse)
library(ggplot2)

```


```{r}
#Datensatz einlesen
data <- read.csv("C:/Users/Antonia/Downloads/swissvotes.csv", header=TRUE, sep=";", na = c("NA", "."))
```


```{r}
#Datensatz anschauen
glimpse(data)
str(data)

```



```{r}
#Variablen definieren um nachher mehrere Spalten gleichzeitig zu mutieren

positionen  <- data %>%
  select(ends_with(".pos")|starts_with("p.")|starts_with("pdev")) 

hauptthema <- data %>%
  select(d1e1, d2e1 ,d3e1)

unterthema <- data %>%
  select(d1e2, d2e2 ,d3e2)

daten <- data%>%
  select(datum, starts_with("dat."))

resultate <- data %>%
  select(ends_with("annahme")| volk | stand)

```


```{r}
#Datensatz thematisch einschränken und neu codieren:
data_cda <- data %>%
  filter((d1e2 > 2 & d1e2 < 4 | (d1e3 > 10.30 & d1e3 < 10.33)) |
         (d2e2 > 2 & d2e2 < 4 | (d2e3 > 10.30 & d2e3 < 10.33))|
         (d3e2 > 2 & d3e2 < 4 | (d3e3 > 10.30 & d3e3 < 10.33)) ) %>% #Filter der Themengebiete
  select(-(ends_with(".fr")|ends_with("_f")|ends_with(".en")))%>% #Entfernung französische Übersetzungen

    mutate(rechtsform = factor(case_when(
    rechtsform == 1 ~ "Obligatorisches Referendum",
    rechtsform == 2 ~ "Fakultatives Referendum",
    rechtsform == 3 ~ "Volksinitiative",
    rechtsform == 4 ~ "Gegenentwurf zu Volksinitiative",
    rechtsform == 5 ~ "Stichfrage")))%>% 
  
  mutate(across(names(positionen), 
           ~ factor(case_when(. == 1 ~ "Befürwortend",
    .== 2 ~"Ablehnend",
    .== 3 ~"Keine",
    .== 8 ~"Vorzug für den Gegenentwurf",
    .== 9 ~"Vorzug für Volksinitiative",)))) %>%
  
  mutate(across(names(hauptthema), 
             ~ factor(case_when(. == 1 ~ "Staatsordnung",
    .== 2 ~ "Aussenpolitik",
    .== 3 ~"Sicherheitspolitik",
    .== 4 ~"Wirtschaft",
    .== 5 ~"Landwirtschaft",
    .== 6 ~"Öffentliche Finanzen",
    .== 7 ~"Energie",
    .== 8 ~"Verkehr und Infrastruktur",
    .== 9 ~"Umwelt und Lebensraum",
    .== 10 ~"Sozialpolitik",
    .== 11 ~"Bildung und Forschung",
    .== 12 ~"Kultur, Religion, Medien",))))%>%
  
  mutate(across(names(unterthema), 
             ~ factor(case_when(. == 2.1 ~ "Aussenpolitische Grundhaltung",
    .== 2.2 ~ "Europapolitik",
    .== 2.3 ~ "Internationale Organisationen",
    .== 2.4 ~ "Entwicklungszusammenarbeit",
    .== 2.5 ~ "Staatsverträge mit einzelnen Staaten",
    .== 2.6 ~"Aussenwirtschaftspolitik",
    .== 2.7 ~"Diplomatie",
    .== 2.8 ~"Auslandschweizer:innen",
    .== 3.1 ~"Öffentliche Sicherheit",
    .== 3.2 ~"Armee",
    .== 3.3 ~"Landesversorgung",
    .== 10.3 ~"Ausländer & Flüchtlinge", 
    TRUE ~"andere")))) %>%
  mutate(across(names(daten), 
                ~ as.Date(., "%d.%m.%Y"))) %>%
  
  mutate(across(names(resultate), 
                ~ factor(case_when(. == 0 ~"abgelehnt", 
                .== 1 ~ "angenommen", 
                .== 3 ~ "Ständemehr nicht nötig", 
                .== 8 ~ "Gegenentwurf angenommen", 
                .== 9 ~ "Volksinitiative angenommen" )))) 





```

```{r}
#neuen Datensatz untersuchen
summary(data_cda)
```

```{r} 
#Variablen selektieren für Data Wrangling / Insight-Generierung

data_eingeschränkt <- data_cda %>%
  select(datum, titel_kurz_d, anzahl, rechtsform, d1e1:legisjahr, bv.pos:srnein, unter.quorum, dauer_bv, unter_g, unter_u, p.fdp:p.bpuk, w.fdp:neutral.summe, inserate.ja, inserate.nein, inserate.jaanteil, mediares.tot:ktjaproz)

glimpse(data_eingeschränkt)
```


```{r}
#Visualisierungen
media <- data_cda %>%
  select(titel_kurz_d, rechtsform, mediaton.d, mediaton.f, mediaton.tot) 

ggplot(media, aes(rechtsform, mediaton.tot, na.rm = TRUE)) +
  geom_boxplot()

ggplot(media, aes(titel_kurz_d, mediaton.d, mediaton.f)) +
  geom_jitter() 

pos <- data_cda %>%
  select(titel_kurz_d, names(positionen))



 




```



